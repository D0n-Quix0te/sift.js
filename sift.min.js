!function(){"use strict";function n(n){return"function"==typeof n}function t(n){return"[object Array]"===Object.prototype.toString.call(n)}function r(n){return n instanceof Date?n.getTime():n instanceof Array?n.map(r):n}function e(n,t){return n.v(n.a,t)}function u(n,t){for(var r=0;r<n.length;r++)if(e(t,n[r]))return r;return-1}function o(n,t){return{a:n,v:t}}function i(n,t){var r=[];return f(t,n.k,0,r),1===r.length?e(n.nv,r[0]):!!~u(r,n.nv)}function f(n,r,e,u){if(e===r.length||void 0==n)return void u.push(n);if(t(n))for(var o=0,i=n.length;i>o;o++)f(n[o],r,e,u);else f(n[r[e]],r,e+1,u)}function c(n,t){return{a:{k:n,nv:t},v:i}}function a(n){n=r(n),(!n||"Object"!==n.constructor.toString()&&"function Object() { [native code] }"!==n.constructor.toString())&&(n={$eq:n});var t=[];for(var e in n){var u=n[e];if(d[e])l[e]&&(u=l[e](u)),t.push(o(r(u),d[e]));else{if(36===e.charCodeAt(0))throw new Error("Unknown operation "+e);t.push(c(e.split("."),a(u)))}}return 1===t.length?t[0]:o(t,d.$and)}function $(n,t){var r=a(n);return t&&(r={a:r,v:function(n,r){return e(n,t(r))}}),r}function s(t,r,u){function o(n){return e(i,n)}n(r)&&(u=r,r=void 0);var i=$(t,u);return r?r.filter(o):o}var d={$eq:function(n,t){return n(t)},$ne:function(n,t){return!n(t)},$or:function(n,t){for(var r=0,u=n.length;u>r;r++)if(e(n[r],t))return!0;return!1},$gt:function(n,t){return r(t)>n},$gte:function(n,t){return r(t)>=n},$lt:function(n,t){return r(t)<n},$lte:function(n,t){return r(t)<=n},$mod:function(n,t){return t%n[0]==n[1]},$in:function(n,t){if(!(t instanceof Array))return!!~n.indexOf(r(t));for(var e=t.length;e--;)if(~n.indexOf(r(t[e])))return!0;return!1},$nin:function(n,t){return!d.$in(n,t)},$not:function(n,t){return!e(n,t)},$type:function(n,t){return void 0!=t?t instanceof n||t.constructor==n:!1},$all:function(n,t){t||(t=[]);for(var e=n.length;e--;)if(!~r(t).indexOf(n[e]))return!1;return!0},$size:function(n,t){return t?n===t.length:!1},$nor:function(n,t){for(var r=0,u=n.length;u>r;r++)if(e(n[r],t))return!1;return!0},$and:function(n,t){for(var r=0,u=n.length;u>r;r++)if(!e(n[r],t))return!1;return!0},$regex:function(n,t){return n.test(t)},$where:function(n,t){return n.call(t,t)},$elemMatch:function(n,r){return t(r)?!!~u(r,n):e(n,r)},$exists:function(n,t){return void 0!=t===n}},l={$eq:function(n){return n instanceof RegExp?function(t){return n.test(r(t))}:n instanceof Function?n:function(t){return t instanceof Array?~r(t).indexOf(n):n===r(t)}},$ne:function(n){return l.$eq(n)},$and:function(n){return n.map(a)},$or:function(n){return n.map(a)},$nor:function(n){return n.map(a)},$not:function(n){return a(n)},$regex:function(n){return new RegExp(n)},$where:function(n){return"string"==typeof n?new Function("obj","return "+n):n},$elemMatch:function(n){return a(n)},$exists:function(n){return!!n}};s.use=function(t){if(n(t))return t(s);for(var r in t)36===r.charCodeAt(0)&&(d[r]=t[r])},s.indexOf=function(n,t,r){return u(t,$(n,r))},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=s:"undefined"!=typeof window&&(window.sift=s)}();
(function(){var s=new function(){function h(a){return a?0:-1}var f=this.priority=function(a,b){for(var c=a.exprs,e=0,d=0,f=c.length;d<f;d++){var g=c[d];if(!~(g=g.e(g.v,b instanceof Date?b.getTime():b,b)))return-1;e+=g}return e},d=this.parse=function(a,b){a||(a={$eq:a});var c=[];if(a.constructor==Object)for(var e in a){var k=j[e]?e:"$trav",i=a[e],g=i;if(r[k]){if(~e.indexOf(".")){g=e.split(".");e=g.shift();for(var h={},n=h,m=0,l=g.length-1;m<l;m++)n=n[g[m]]={};n[g[m]]=i;g=i=h}if(i instanceof Array){g=
[];for(h=i.length;h--;)g.push(d(i[h]))}else g=d(i,e)}c.push(q(k,e,g))}else c.push(q("$eq",e,a));var p={exprs:c,k:b,test:function(a){return~p.priority(a)},priority:function(a){return f(p,a)}};return p},r={$and:!0,$or:!0,$nor:!0,$trav:!0,$not:!0},j={$eq:function(a,b){return h(a.test(b))},$ne:function(a,b){return h(!a.test(b))},$lt:function(a,b){return a>b?0:-1},$gt:function(a,b){return a<b?0:-1},$lte:function(a,b){return a>=b?0:-1},$gte:function(a,b){return a<=b?0:-1},$exists:function(a,b){return a==
!!b?0:-1},$in:function(a,b){if(b instanceof Array)for(var c=b.length;c--;){if(~a.indexOf(b[c]))return c}else return h(~a.indexOf(b));return-1},$not:function(a,b){return h(!a.test(b))},$type:function(a,b,c){return c?c instanceof a||c.constructor==a?0:-1:-1},$nin:function(a,b){return~j.$in(a,b)?-1:0},$mod:function(a,b){return b%a[0]==a[1]?0:-1},$all:function(a,b){for(var c=a.length;c--;)if(-1==b.indexOf(a[c]))return c;return-1},$size:function(a,b){return b?a==b.length?0:-1:-1},$or:function(a,b){for(var c=
a.length,e,d=c;c--;)if(~(e=f(a[c],b,c)))return e;return 0==d?0:-1},$nor:function(a,b){for(var c=a.length;c--;)if(~f(a[c],b))return-1;return 0},$and:function(a,b){for(var c=a.length;c--;)if(!~f(a[c],b))return-1;return 0},$trav:function(a,b){if(b instanceof Array){for(var c=b.length;c--;){var e=b[c];if(e[a.k]&&~f(a,e[a.k]))return c}return-1}return b?f(a,b[a.k]):-1}},k={$eq:function(a){return a instanceof RegExp?a:{test:a instanceof Function?a:function(b){return b instanceof Array?~b.indexOf(a):a==b}}},
$ne:function(a){return k.$eq(a)}},q=function(a,b,c){c=c instanceof Date?c.getTime():c;return{k:b,v:k[a]?k[a](c):c,e:j[a]}}},l=function(h,f,d){"object"!=typeof f&&(d=f,f=void 0);if(d){if("function"!=typeof d)throw Error("Unknown sift selector "+d);}else d=function(d){return d};var l=d,j=s.parse(h),d=function(d){for(var f=[],a,b,c=0,e=d.length;c<e;c++)a=l(d[c]),~(b=j.priority(a))&&f.push({value:a,priority:b});f.sort(function(a,b){return a.priority>b.priority?-1:1});d=Array(f.length);for(c=f.length;c--;)d[c]=
f[c].value;return d};d.test=j.test;d.query=h;return f?d(f):d};"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=l:"undefined"!=typeof window&&(window.sift=l)})();
!function(){"use strict";function n(n){return"function"==typeof n}function r(n){return"[object Array]"===Object.prototype.toString.call(n)}function t(n){return n instanceof Date?n.getTime():n instanceof Array?n.map(t):n}function e(n,r){for(var t=0,e=n.length;e>t;t++)if(!n[t](r))return!1;return!0}function u(n,r){for(var t=0;t<n.length;t++)if(r(n[t]))return t;return-1}function o(n,r){var t=n.split(".");return function(n){var e=[];return i(n,t,0,e),1===e.length?r(e[0]):!!~u(e,r)}}function i(n,t,e,u){if(e===t.length||void 0==n)return void u.push(n);if(r(n))for(var o=0,f=n.length;f>o;o++)i(n[o],t,e,u);else i(n[t[e]],t,e+1,u)}function f(n){n=t(n),(!n||"Object"!==n.constructor.toString()&&"function Object() { [native code] }"!==n.constructor.toString())&&(n={$eq:n});var r=[];for(var u in n){var i=n[u];if(a[u])r.push(a[u](t(i)));else{if(36===u.charCodeAt(0))throw new Error("Unknown operation "+u);r.push(o(u,f(i)))}}var c=r.length;return 1===c?r[0]:function(n){return e(r,n)}}function c(r,t,e){var u=f(r);return n(t)&&(e=t,t=void 0),e&&(u=function(n){return e(n)}),t?t.filter(u):u}var a={$eq:function(n){var r;return r=n instanceof RegExp?function(r){return n.test(t(r))}:n instanceof Function?n:function(r){return r instanceof Array?~t(r).indexOf(n):n===t(r)}},$ne:function(n){var r=a.$eq(n);return function(n){return!r(n)}},$or:function(n){var r=n.map(f),e=r.length;return function(n){for(var u=0;e>u;u++)if(r[u](t(n)))return!0;return!1}},$gt:function(n){return function(r){return t(r)>n}},$gte:function(n){return function(r){return t(r)>=n}},$lt:function(n){return function(r){return t(r)<n}},$lte:function(n){return function(r){return t(r)<=n}},$mod:function(n){return function(r){return t(r)%n[0]==n[1]}},$in:function(n){return function(r){if(!(r instanceof Array))return!!~n.indexOf(t(r));for(var e=r.length;e--;)if(~n.indexOf(t(r[e])))return!0;return!1}},$nin:function(n){var r=a.$in(n);return function(n){return!r(t(n))}},$not:function(n){var r=f(n);return function(n){return!r(t(n))}},$type:function(n){return function(r){return void 0!=r?r instanceof n||r.constructor==n:!1}},$all:function(n){return function(r){r||(r=[]);for(var e=n.length;e--;)if(!~t(r).indexOf(n[e]))return!1;return!0}},$size:function(n){return function(r){return r?n===r.length:!1}},$nor:function(n){var r=n.map(f),e=r.length;return function(n){for(var u=0;e>u;u++)if(r[u](t(n)))return!1;return!0}},$and:function(n){var r=n.map(f);return function(n){return e(r,n)}},$regex:function(n){var r=new RegExp(n);return function(n){return r.test(n)}},$where:function(n){var r="string"==typeof n?new Function("obj","return "+n):n;return function(n){return r.call(n,n)}},$elemMatch:function(n){var t=f(n);return function(n){return r(n)?!!~u(n,t):t(n)}},$exists:function(n){return n=!!n,function(r){return void 0!=r===n}}};c.use=function(r){if(n(r))return r(c);for(var t in r)36===t.charCodeAt(0)&&(a[t]=r[t])},c.indexOf=function(n,r,t){return u(r,c(n,t))},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=c:"undefined"!=typeof window&&(window.sift=c)}();
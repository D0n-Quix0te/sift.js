(function(){var o=function(b,e){for(var j={},h=j,f=0,g=b.length-1;f<g;f++)h=h[b[f]]={};h[b[f]]=e;return j},p=new function(){function b(a){return a?0:-1}var e=this.priority=function(a,c){for(var d=a.exprs,b=0,e=0,f=d.length;e<f;e++){var i=d[e];if(!~(i=i.e(i.v,c instanceof Date?c.getTime():c,c)))return-1;b+=i}return b},j=this.parse=function(a,c){a||(a={$eq:a});var d=[];if(a.constructor==Object)for(var b in a){var g=f[b]?b:"$trav",k=a[b],i=k;if(h[g])if(~b.indexOf(".")&&(i=b.split("."),b=i.shift(),i=
k=o(i,k)),k instanceof Array)for(var i=[],l=k.length;l--;)i.push(j(k[l]));else i=j(k,b);d.push(n(g,b,i))}else d.push(n("$eq",b,a));var m={exprs:d,k:c,test:function(a){return~m.priority(a)},priority:function(a){return e(m,a)}};return m},h={$and:!0,$or:!0,$nor:!0,$trav:!0,$not:!0},f={$eq:function(a,c){return b(a.test(c))},$ne:function(a,c){return b(!a.test(c))},$lt:function(a,c){return b(a>c)},$gt:function(a,c){return b(a<c)},$lte:function(a,c){return b(a>=c)},$gte:function(a,c){return b(a<=c)},$exists:function(a,
c){return b(a==!!c)},$in:function(a,c){if(c instanceof Array)for(var d=c.length;d--;){if(~a.indexOf(c[d]))return d}else return b(~a.indexOf(c));return-1},$not:function(a,c){return b(!a.test(c))},$type:function(a,c,d){return d?b(d instanceof a||d.constructor==a):-1},$nin:function(a,c){return~f.$in(a,c)?-1:0},$mod:function(a,c){return c%a[0]==a[1]?0:-1},$all:function(a,c){for(var b=a.length;b--;)if(-1==c.indexOf(a[b]))return b;return-1},$size:function(a,c){return c?b(a==c.length):-1},$or:function(a,
c){for(var d=a.length,f=d;d--;)if(~e(a[d],c))return d;return b(0==f)},$nor:function(a,c){for(var b=a.length;b--;)if(~e(a[b],c))return-1;return 0},$and:function(a,c){for(var b=a.length;b--;)if(!~e(a[b],c))return-1;return 0},$trav:function(a,c){if(c instanceof Array){for(var b=c.length;b--;){var f=c[b];if(f[a.k]&&~e(a,f[a.k]))return b}return-1}return c?e(a,c[a.k]):-1}},g={$eq:function(a){return a instanceof RegExp?a:{test:a instanceof Function?a:function(c){return c instanceof Array?~c.indexOf(a):a==
c}}},$ne:function(a){return g.$eq(a)}},n=function(a,c,b){b=b instanceof Date?b.getTime():b;return{k:c,v:g[a]?g[a](b):b,e:f[a]}}},q=function(b){if(b){if("function"==typeof b)return b}else return function(b){return b};throw Error("Unknown sift selector "+b);},r=function(b,e){var j=p.parse(b),h=function(b){for(var g=[],h,a,c=0,d=b.length;c<d;c++)h=e(b[c]),~(a=j.priority(h))&&g.push({value:h,priority:a});g.sort(function(a,b){return a.priority>b.priority?-1:1});b=Array(g.length);for(c=g.length;c--;)b[c]=
g[c].value;return b};h.test=j.test;h.query=b;return h},l=function(b,e,j){"object"!=typeof e&&(j=e,e=void 0);b=r(b,q(j));return e?b(e):b};"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=l:"undefined"!=typeof window&&(window.sift=l)})();

(function(){var o=function(d,h){for(var f={},j=f,g=0,i=d.length-1;g<i;g++)j=j[d[g]]={};j[d[g]]=h;return f},p=new function(){var d=this.test=function(a,b){for(var c=a.exprs,e=0,d=c.length;e<d;e++){var f=c[e];if(!f.e(f.v,b instanceof Date?b.getTime():b,b))return!1}return!0},h=this.parse=function(a,b){var c=[];if(a)if(a.constructor==Object)for(var e in a){var g=j[e]?e:"$trav",l=a[e],k=l;if(f[g])if(e.indexOf(".")>-1&&(k=e.split("."),e=k.shift(),l=o(k,l)),l instanceof Array)for(var k=[],m=l.length;m--;)k.push(h(l[m]));
else k=h(a[e],e);c.push(i(g,e,k))}else c.push(i("$eq",e,a));var n={exprs:c,k:b,test:function(a){return d(n,a)}};return n},f={$and:!0,$or:!0,$nor:!0,$trav:!0,$not:!0},j={$eq:function(a,b){return a.test(b)},$ne:function(a,b){return!a.test(b)},$lt:function(a,b){return a>b},$gt:function(a,b){return a<b},$lte:function(a,b){return a>=b},$gte:function(a,b){return a<=b},$exists:function(a,b){return a==!!b},$in:function(a,b){if(b instanceof Array)for(var c=b.length;c--;){if(a.indexOf(b[c])>-1)return!0}else return a.indexOf(b)>
-1},$not:function(a,b){return!a.test(b)},$type:function(a,b,c){return c?c instanceof a||c.constructor==a:!1},$nin:function(a,b){return!j.$in(a,b)},$mod:function(a,b){return b%a[0]==a[1]},$all:function(a,b){for(var c=a.length;c--;)if(b.indexOf(a[c])==-1)return!1;return!0},$size:function(a,b){return b?a==b.length:!1},$or:function(a,b){for(var c=a.length,e=c;c--;)if(d(a[c],b))return!0;return!e},$nor:function(a,b){for(var c=a.length,e=c;c--;)if(!d(a[c],b))return!0;return!e},$and:function(a,b){for(var c=
a.length;c--;)if(!d(a[c],b))return!1;return!0},$trav:function(a,b){if(b instanceof Array){for(var c=b.length;c--;){var e=b[c];if(e[a.k]&&d(a,e[a.k]))return!0}return!1}return b?d(a,b[a.k]):!1}},g={$eq:function(a){var b;return a instanceof RegExp?a:{test:a instanceof Function?a:function(b){return a==b}}},$ne:function(a){return g.$eq(a)}},i=function(a,b,c){c=c instanceof Date?c.getTime():c;return{k:b,v:g[a]?g[a](c):c,e:j[a]}}},q=function(d){var h=p.parse(d),f=function(d){for(var f=[],i=0,a=d.length;i<
a;i++)h.test(d[i])&&f.push(d[i]);return f};f.test=h.test;f.query=d;return f},m=function(d,h){var f=q(d);return h?f(h):f};if(typeof module!="undefined"&&typeof module.exports!="undefined")module.exports=m;else if(typeof window!="undefined")window.sift=m})();

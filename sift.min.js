(function(){var s=new function(){var h=this.test=function(a,b){for(var c=a.exprs,d=0,e=c.length;d<e;d++){var f=c[d];if(!f.e(f.v,b instanceof Date?b.getTime():b,b))return!1}return!0},j=this.parse=function(a,b){a||(a={$eq:a});var c=[];if(a.constructor==Object)for(var d in a){var i=k[d]?d:"$trav",f=a[d],g=f;if(e[i]){if(-1<d.indexOf(".")){g=d.split(".");d=g.shift();for(var l={},p=l,m=0,n=g.length-1;m<n;m++)p=p[g[m]]={};p[g[m]]=f;g=f=l}if(f instanceof Array){g=[];for(l=f.length;l--;)g.push(j(f[l]))}else g=
j(f,d)}c.push(q(i,d,g))}else c.push(q("$eq",d,a));var r={exprs:c,k:b,test:function(a){return h(r,a)}};return r},e={$and:!0,$or:!0,$nor:!0,$trav:!0,$not:!0},k={$eq:function(a,b){return a.test(b)},$ne:function(a,b){return!a.test(b)},$lt:function(a,b){return a>b},$gt:function(a,b){return a<b},$lte:function(a,b){return a>=b},$gte:function(a,b){return a<=b},$exists:function(a,b){return a==!!b},$in:function(a,b){if(b instanceof Array)for(var c=b.length;c--;){if(-1<a.indexOf(b[c]))return!0}else return-1<
a.indexOf(b)},$not:function(a,b){return!a.test(b)},$type:function(a,b,c){return c?c instanceof a||c.constructor==a:!1},$nin:function(a,b){return!k.$in(a,b)},$mod:function(a,b){return b%a[0]==a[1]},$all:function(a,b){for(var c=a.length;c--;)if(-1==b.indexOf(a[c]))return!1;return!0},$size:function(a,b){return b?a==b.length:!1},$or:function(a,b){for(var c=a.length,d=c;c--;)if(h(a[c],b))return!0;return!d},$nor:function(a,b){for(var c=a.length;c--;)if(h(a[c],b))return!1;return!0},$and:function(a,b){for(var c=
a.length;c--;)if(!h(a[c],b))return!1;return!0},$trav:function(a,b){if(b instanceof Array){for(var c=b.length;c--;){var d=b[c];if(d[a.k]&&h(a,d[a.k]))return!0}return!1}return b?h(a,b[a.k]):!1}},i={$eq:function(a){return a instanceof RegExp?a:{test:a instanceof Function?a:function(b){return b instanceof Array?-1<b.indexOf(a):a==b}}},$ne:function(a){return i.$eq(a)}},q=function(a,b,c){c=c instanceof Date?c.getTime():c;return{k:b,v:i[a]?i[a](c):c,e:k[a]}}},n=function(h,j,e){"object"!=typeof j&&(e=j,j=
void 0);if(e){if("function"!=typeof e)throw Error("Unknown sift selector "+e);}else e=function(e){return e};var k=e,i=s.parse(h),e=function(e){for(var a=[],b,c=0,d=e.length;c<d;c++)b=k(e[c]),i.test(b)&&a.push(b);return a};e.test=i.test;e.query=h;return j?e(j):e};"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=n:"undefined"!=typeof window&&(window.sift=n)})();
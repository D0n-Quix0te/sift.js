!function(){function n(n,t){for(var r={},e=r,o=0,u=n.length-1;u>o;o++)e=e[n[o]]={};return e[n[o]]=t,r}function t(){function t(n){return n instanceof Date?n.getTime():n}function r(n,r,e){var o=t(e);return{k:r,v:f[n]?f[n](o):o,e:i[n]}}var e=this.test=function(n,r){for(var e=n.exprs,o=0,u=e.length;u>o;o++){var i=e[o];if(!i.e(i.v,t(r),r))return!1}return!0},o=this.parse=function(t,f){t||(t={$eq:t});var s=[];if("[object Object]"===Object.prototype.toString.call(t))for(var a in t){var c;if(i[a])c=a;else{if("$"===a.substr(0,1))throw new Error("Unknown operator "+a+".");c="$trav"}var v=t[a],l=v;if(u[c]){if(~a.indexOf(".")){var $=a.split(".");a=$.shift(),l=v=n($,v)}if(v instanceof Array){l=[];for(var p=v.length;p--;)l.push(o(v[p]))}else l=o(v,a)}s.push(r(c,a,l))}else s.push(r("$eq",f,t));var d={exprs:s,k:f,test:function(n){return e(d,n)}};return d},u=this.traversable={$and:!0,$or:!0,$nor:!0,$trav:!0,$not:!0},i=this.testers={$eq:function(n,t){return n.test(t)},$ne:function(n,t){return!n.test(t)},$lt:function(n,t){return n>t},$gt:function(n,t){return t>n},$lte:function(n,t){return n>=t},$gte:function(n,t){return t>=n},$exists:function(n,t){return n===(null!=t)},$in:function(n,t){if(!(t instanceof Array))return~n.indexOf(t);for(var r=t.length;r--;)if(~n.indexOf(t[r]))return!0;return!1},$not:function(n,t){if(!n.test)throw new Error("$not test should include an expression, not a value. Use $ne instead.");return!n.test(t)},$type:function(n,t,r){return null!=r?r instanceof n||r.constructor==n:!1},$nin:function(n,t){return!i.$in(n,t)},$mod:function(n,t){return t%n[0]==n[1]},$all:function(n,t){t||(t=[]);for(var r=n.length;r--;){var e=n[r],o=~t.indexOf(e);if(!o)return!1}return!0},$size:function(n,t){return t?n===t.length:!1},$or:function(n,t){for(var r=n.length,o=r;r--;)if(e(n[r],t))return!0;return 0===o},$nor:function(n,t){for(var r=n.length;r--;)if(e(n[r],t))return!1;return!0},$and:function(n,t){for(var r=n.length;r--;)if(!e(n[r],t))return!1;return!0},$trav:function(n,t){if(t instanceof Array){for(var r=t.length;r--;){var o=t[r];if(o[n.k]&&e(n,o[n.k]))return!0}return!1}return e(n,t?t[n.k]:void 0)},$regex:function(n,t){var r=new RegExp(n);return r.test(t)}},f={$eq:function(n){var t;return n instanceof RegExp?n:(t=n instanceof Function?n:function(t){return t instanceof Array?~t.indexOf(n):n===t},{test:t})},$ne:function(n){return f.$eq(n)}}}function r(n,t){var r=o.parse(n),e=function(n){for(var e,o,u=[],i=0,f=n.length;f>i;i++)o=n[i],e=t(o),r.test(e)&&u.push(o);return u};return e.test=r.test,e.query=n,e}function e(n,t,e){"object"!=typeof t&&(e=t,t=void 0);var o=r(n,u(e));return t?o(t):o}var o=new t,u=function(n){if(!n)return function(n){return n};if("function"==typeof n)return n;throw new Error("Unknown sift selector "+n)};e.use=function(n){n.operators&&e.useOperators(n.operators),"function"==typeof n&&n(e)},e.useOperators=function(n){for(var t in n)e.useOperator(t,n[t])},e.useOperator=function(n,t){var r={};r="object"==typeof t?t:{test:t};var e="$"+n;o.testers[e]=r.test,(r.traversable||r.traverse)&&(o.traversable[e]=!0)},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=e:"undefined"!=typeof window&&(window.sift=e)}();